{% extends "users/home.html" %}
{% load static %}
{% load custom_filters %}

{% block header %}
Fmk Shop - {{ product.name }} Details
{% endblock %}

{% block main_block %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Product Image -->
        <div class="flex justify-center">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="rounded-lg shadow-xl max-w-full h-auto object-cover">
        </div>

        <!-- Product Information -->
        <div class="flex flex-col justify-start">
            <!-- Product Name -->
            <h1 class="text-3xl sm:text-4xl font-extrabold text-yellow-600 mb-4">{{ product.name }}</h1>

            <!-- Product Description -->
            <p class="text-lg text-gray-700 leading-relaxed mb-6">{{ product.description }}</p>

            <!-- Product Price -->
            <p class="text-2xl font-semibold text-yellow-600 mb-6">Price: Tsh {{ product.price }}/=</p>

            <!-- Add to Cart Section -->
            <div class="flex items-center space-x-4 mb-6">
                <form class="add-to-cart-form flex items-center w-full" data-product-id="{{ product.id }}">
                    {% csrf_token %}
                    <label for="quantity" class="text-lg text-gray-600">Quantity:</label>
                    <input type="number" id="quantity" name="quantity" min="1" value="1"
                           class="border border-gray-300 rounded-lg m-1 p-3 w-24 text-center focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-yellow-600">
                    <button type="submit"
                            class="w-full sm:w-auto bg-yellow-600 text-white py-3 px-2 rounded-lg shadow-lg hover:bg-yellow-500 transition ease-in-out duration-200">
                        Add to Cart
                    </button>
                </form>
            </div>

            <!-- Back to Products Link -->
            <div class="mt-6 text-center">
                <a href="{% url 'shop' %}" class="text-lg text-yellow-500 hover:text-yellow-600 font-semibold">
                    Back to Products
                </a>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript to Handle Add to Cart -->
<script>
document.querySelector('.add-to-cart-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const productId = this.getAttribute('data-product-id');
    const quantity = this.querySelector('[name="quantity"]').value;

    fetch("{% url 'add_to_cart' 0 %}".replace('0', productId), {
        method: 'POST',
        body: new FormData(this),
        headers: {
            'X-CSRFToken': document.querySelector('[name="csrfmiddlewaretoken"]').value,
        }
    })
    .then(response => response.json())
    .then(data => {
        alert('Product added to cart!');
        document.getElementById('cart-item-count').textContent = data.cart_item_count;
        document.getElementById('cart-total').textContent = `$${data.cart_total}`;
    })
    .catch(error => {
        console.error('Error adding product to cart:', error);
    });
});
</script>
{% endblock %}